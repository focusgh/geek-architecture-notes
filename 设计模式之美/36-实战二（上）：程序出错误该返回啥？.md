[toc]

## 36 | 实战二（上）：程序出错误该返回啥？NULL、异常、错误码、空对象？

-   函数运行结果分为两类
    -   一类是预期结果，也就是函数在正常情况下输出的结果。
    -   一类是非预期结果，也就是函数在异常情况下输出的结果。
-   正常情况下，函数返回数据的类型非常明确。但，在异常情况下，函数返回的数据类型却非常灵活，有多种选择。
-   函数在异常情况下还可以返回错误码、NULL 值、特殊值（如-1）、空对象等。

### 函数出错应该返回啥？

#### 1. 返回错误码

#### 2. 返回 NULL 值

#### 3. 返回空对象

#### 4. 抛出异常对象

-   异常分类
    -   在 C++和大部分动态语言（Python、Ruby、JavaScript 等）都只定义了一种异常类型：**运行时异常（Runtime Exception）**，而像 Java,除了运行时异常外，还定义了另外一种异常类型：**编译时异常（Compile Exception）**。
    -   在运行时异常，我们在编写代码的时候，可以不用主动去 try-catch，编译器在编译代码的时候，并不会检查代码是否对运行时异常做了处理。运行时异常也叫**非受检异常**。
    -   相反，对于编译时异常，我们在编写代码的时候，需要主动去 try-catch 或者在函数定义中声明，否则编译就会报错。编译时异常也叫**受检异常**。

-   下面，我们再来讲下，**如何处理函数抛出的异常？**一般有下面三种处理方法：

    1.  直接吞掉

        -   ```java
            
            public void func1() throws Exception1 {
              // ...
            }
            
            public void func2() {
              //...
              try {
                func1();
              } catch(Exception1 e) {
                log.warn("...", e); //吐掉：try-catch打印日志
              }
              //...
            }
            ```

        -   

    2.  原封不动地 re-throw

        -   ```java
            
            public void func1() throws Exception1 {
              // ...
            }
            
            
            public void func2() throws Exception1 {//原封不动的re-throw Exception1
              //...
              func1();
              //...
            }
            ```

        -   

    3.  包装成新的异常 re-throw

        -   ```java
            
            public void func1() throws Exception1 {
              // ...
            }
            
            
            public void func2() throws Exception2 {
              //...
              try {
                func1();
              } catch(Exception1 e) {
               throw new Exception2("...", e); // wrap成新的Exception2然后re-throw
              }
              //...
            }
            ```

-   当我们面对函数抛出异常的时候，应该选择上面哪种处理方式。总结 如下原则：

    1.  关于是否往上继续抛出，**要看上层代码是否关心这个异常**。关心就将它抛出，否则就直接吞掉。
    2.  是否需要包装成新的异常抛出，**看上层代码是否能理解这个异常、是否业务相关**。如果能理解、业务相关就可以直接抛出，否则就封装成新的异常抛出。

### 重点回顾

1.  **返回错误码**
    -   C 语言没有异常语法机制，返回错误码便是最常用的出错处理方式。
    -   而 Java、Python 等较新的编程语言中， 大部分情况下，我们都用异常来处理函数出错的情况。极少用到错误码。
2.  **返回 NULL 值**
    -   对于**查找函数来**说，数据不存在并非一种异常情况，是一种正常行为，所以，返回 NULL 值比返回异常更加合理。
3.  **返回空对象**
    -   返回 NULL 值有各种弊端，对此有一个比较经典的应对策略，那就是应用**空对象设计模式**。
    -   当函数返回的数据是字串类型或者集合类型的时候，我们可以用空字串或空集合替代 NULL 值，来表示不存在的情况。这样，我们在使用函数的时候，就可以不用做 NULL 值判断。
4.  抛出异常对象
    -   最常用的函数出错处理方式是抛出异常。异常有两种类型：**受检异常和非受检异常。**
        -   对于受检异常和非受检异常，我们只需要根据团队的开发习惯，在同一个项目中制定统一的异常处理规范即可。
    -   对于函数抛出异常，我们有三种处理方法：**直接吞掉、直接往上抛出、包裹成新的异常抛出。**

