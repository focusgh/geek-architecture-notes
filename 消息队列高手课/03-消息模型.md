[toc]

## 03 | 消息模型：主题和队列有什么区别？

1.  什么是队列？什么是主题？主题和队列又有什么区别呢？

### 主题和队列有什么区别？

1.  “队列”是一种数据结构，特点：
    -   **先进先出**
    -   **严格有序**
2.  早期的消息队列，就是按照“**队列**”的数据结构来设计的。
3.  **队列模型**
    -   ![img](imgs/b18f43f67ae1b0d24d88f0ba39708a84.jpg)
4.  **发布-订阅模式**
    -   ![img](imgs/d5c0742113b2a6f5a419e1ffc3327354.jpg)
5.  两种模型最大的区别其实就是：
    -   **一份消息数据能不能被消费多次的问题**。

### RabbitMQ 的消息模型

1.  RabbitMQ 使用**队列模型**，Exchange 来决定将消息投递到哪些队列中。
    -   ![img](imgs/2df04ce80ff54702240df8598f277ca5.jpg)

### RocketMQ 的消息模型

1.  使用**发布-订阅模型**。
2.  几乎所有的消息队列都使用一种非常朴素的“**请求-确认**”机制。
    -   保证消息传递过程中的**可靠性**。
    -   为了确保消息的**有序性**，在某一条消息被成功消费前，下一条消息是不能被消费的。
3.  **每个主题包含多个队列，通过多个队列来实现多实例并行生产和消费**。
4.  RocketMQ 为每个消费组在每个队列上维护一个**消费位置（Consumer Offset）**。
5.  消息模型图
    -   ![img](imgs/465142ab5b5096f283118c307e8cc117.jpg)

### Kafka 的消息模型

1.  Kafka 的消息模型和 RocketMQ 是完全一样的。

### 小结

1.  **队列和主题**对应着两种不同的消息模型：**队列模型和发布-订阅模型**。
    -   这两种消息模型没有本质上的区别。
2.  RabbitMQ 采用的是队列模型。
3.  RocketMQ 和 Kafka 采用的是发布-订阅模型，并且两者消息模型是基本一致的。

