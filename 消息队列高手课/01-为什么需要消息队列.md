[toc]

## 01 | 为什么需要消息队列？

1.  今天来讲讲为什么需要消息队列，消息队列主要解决的是什么问题？

### 哪些问题适合使用消息队列来解决?

#### 异步处理

1.  秒杀系统中使用消息队列异步操作
    -   ![img](imgs/d2c1ee3d4478580c0d2a8d80d0e833be.jpg)
2.  这个场景中，消息队列被用于实现服务的异步处理。这样做的**好处**是：
    -   可以更快地返回结果。
    -   减少等待，提升系统总体性能。

#### 流量控制

1.  如果避免过多的请求压垮我们的秒杀系统？
    -   我们的设计思路是，**使用消息队列隔离网关和后端服务，以达到流量控制和保持后端服务的目的**。
2.  加入消息队列后，整个秒杀流程变为：
    -   网关在收到请求后，将请求放入请求消息队列。
    -   后端服务从请求消息队列中获取 APP 请求，完成处理过程，然后返回结果。
    -   ![img](imgs/7909fb792a059e22a0a269c1f2cde64a.jpg)
3.  优点：
    -   能根据下游的处理能力自动调节流量，达到“**削峰填谷**”的作用。
4.  代码
    -   总体响应时延变长
    -   增加了系统的复杂度
5.  使用**令牌桶**，进行流量控制
    -   单位时间内只发放固定数量的令牌到令牌桶中，规定服务在处理请求之前必须先从令牌桶中拿出一个令牌，如果令牌桶中没有令牌，则拒绝请求。
    -   这样就保证单位时间内，能处理的请求不超过发放令牌的数量，起到了流量控制的作用。
    -   ![img](imgs/2c4e42056b78fff7746de28245910f89.jpg)

#### 服务解耦

1.  实现上下游系统应用间的**解耦**。

### 小结

1.  以上就是消息队列最常被使用的三种场景：
    -   异步处理
    -   流量控制
    -   服务解耦

