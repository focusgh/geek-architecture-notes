[toc]

## 19 | 数据压缩：时间换空间的游戏

1.  数据压缩不仅能**节省存储空间**，不可以用于**提升网络传输性能**。
2.  如何使用压缩？选择什么样的压缩算法？

### 什么情况适合使用数据压缩？

1.  当前场景是否真的适合使用数据压缩？
    -   不压缩
        -   传输未压缩数据的耗时
    -   压缩
        -   压缩耗时 + 传输压缩数据耗时 + 解压耗时
2.  场景，
    -   如果你的应用需要耗费大量 CPU 资源，就不太适合再进行压缩。
    -   如果你的应用的 CPU 资源很闲，就非常适合把数据压缩再传输。
3.  本质，
    -   时间换空间，或者 CPU 资源换存储资源。

### 应该选择什么压缩算法？

1.  压缩算法
    -   有损压缩
        -   压缩音视频
    -   无损压缩
        -   数据压缩
2.  **压缩样本**对压缩速度和压缩比影响也比较大。

### 如何选择合适的压缩分段

1.  **分段原因**
    -   压缩前，会对压缩数据从头到尾扫描，确定如何对数据进行划分和编码。
2.  **根据业务，选择合适的压缩分段**。在压缩率、压缩速度和解压浪费间找到一个合适的平衡

### Kafka 是如何处理消息压缩的？

1.  开启压缩时，Kafka 选择一批消息一起压缩，**每一批消息就是一个压缩分段**。
2.  生产者压缩消息发送给服务端，服务端不会拆分批消息。然后再整批发送给消费者，由消费者进行解压。
3.  在**服务端不用解压**，就不会耗费服务端宝贵的 CPU 资源，同时还能获得压缩后，占用传输带宽小，占用存储空间小的这些好处，这是一个非常聪明的设计

### 小结

1.  数据压缩，本质上是用 CPU 资源换取存储资源，或者是用压缩、解压时间来换取存储的空间。
2.  选择算法，需考虑的因素
    -   压缩时间
    -   压缩率
    -   压缩内容
    -   压缩分段大小

3.  Kafka 是如何处理消息压缩的。
    -   生产者，对每批消息进行压缩。
    -   批消息在服务端不解压
    -   消费者，在收到消息后再进行解压
    -   Kafka 的压缩和解压都是在客户端完成的。